
Originally from Sydney Blattman, Tavazoie Lab, Columbia University, March 2020, 
"Prokaryotic single-cell RNA sequencing by in situ combinatorial indexing" (doi: 10.1038/s41564-020-0729-6).

Updated by Alyssa R. Hamm, May 2025 to represent the workflow from our paper. 
########ARH annotations


Pipeline:
Example commands can be run from demo folder
1. Create a folder with the sample name (eg first1000) and put fastq files in this folder (all lanes, paired end)
  Run the following from directory containing the folder with sample name 
######## Our data is in the SRA database, with all forward lanes in one folder, and all reverse in a second folder
2. Make sure all fastq files have names in the form: {sample name}_{S#}_L00{#}_Z1_001.fastq.gz or {sample name}_{S#}_L00{#}_R2_001.fastq.gz
######## For example: M1_S1_L001_R1_001.fastq.gz and M1_S1_L001_R2_001.fastq.gz
3. SCRIPT: python [path]/PETRI_seq_scripts/scripts/sc_pipeline_11.py {full_sample} {n_lanes} 
	# full_sample is sample name and S number (eg M1_S5)
	# n_lanes is the number of sequencing lanes for analysis - if lanes are merged, then the single file should be names with 
    suffix _L001_R1_001.fastq.gz and n_lanes set to 1. The script will count lanes from 1 to n_lanes so always start numbering from 1.
	# sc_pipeline_11 runs fastqc, quality filter, and barcode demultiplexing
	# This step will take a few hours for ~50 million reads
######## python [path]/PETRI_seq_scripts/scripts/sc_pipeline_11.py M1_S1 1
3. Look at {sample}_bc1_ReadsPerBC.eps and {sample}_bc1_kneePlot.eps to determine number of BCs to include in further analysis
######## In our study, we used a cut off of 50 counts per barcode for our analysis.
4. SCRIPT: [path]/PETRI_seq_scripts/scripts/pipeline.sh {sample} {n_BCs} {fasta} {gff} {custom_name} 
	# n_BCs is number of BCs to include in further analysis (typically 10000-40000)
	# fasta is location and name of fasta for alignment
	# gff is location and name of gff for feature calling - see example.gff for example format (specifically, gene names should be indicated by 'name=')
	# Custom name is a new name for the sample, corresponding to maybe the gff used or other specific input of the pipeline. For example, we might analyze 
    the same cells by operon or by gene and would indicate that in the custom name. Custom name can be the same as sample name if desired. 
	# pipeline.sh includes a number of cleanup commands at the end. If interested in intermediate files, these can be easily commented out.
######## [path]/PETRI_seq_scripts/scripts/pipeline.sh M1 53958 [path]/PETRI_seq_scripts/scripts/SgChalis_Aa1169_GCF.fna [path]/PETRI_seq_scripts/scripts/SgAa.gff M1 
